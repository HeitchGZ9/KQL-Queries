////Antivirus Exploitation Framework Detection (MDE////
////Exploitation Frameworks////
let ExploitFrameworks = datatable(Name:string)
[
    "MeteTool",
    "MPreter",
    "Meterpreter",
    "Metasploit",
    "PowerSploit",
    "CobaltStrike",
    "Swrort",
    "Rozena",
    "Backdoor.Cobalt",
    "CobaltStr",
    "COBEACON",
    "Cometer",
    "Razy",
    "IISExchgSpawnCMD",
    "Exploit.Script.CVE"
];
////Device Events Query logic////
DeviceEvents
| where ActionType in ("AntivirusDetection", "AntivirusScanCompleted")
| extend DeviceName = tostring(split(DeviceName, ".")[0])
| where FileName has_any (ExploitFrameworks)
    or AdditionalFields has_any (ExploitFrameworks)
| project 
    TimeGenerated,
    DeviceName,
    ActionType,
    FileName,
    FolderPath,
    SHA256,
    InitiatingProcessAccountName,
    InitiatingProcessCommandLine,
    InitiatingProcessFolderPath,
    InitiatingProcessSHA256,
    MachineGroup,
    AdditionalFields
| sort by TimeGenerated desc

